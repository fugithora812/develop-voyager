# 【RDB】ACIDについて改めてまとめてみる

DBのトランザクション処理に求められる4つの特性である`ACID`について、改めて学んだのでまとめてみる。

## A: 原子性 (Atomicity)

「エラーの際にトランザクションを中断し、そのトランザクションすべての書き込みを破棄できること」が、原子性の意味するところ。言い換えるなら「**中断可能性 (Abortability)**」。

逆にもし原子性がなければ、複数の変更を伴う過程でエラーが生じた場合に実際に効果を持った変更とそうでない変更を知るのが難しくなる。

## C: 一貫性 (Consistency)

ACIDにおける一貫性は「データについて常に真でなければならない何らかの言明(不変性)がある」ということ。

『データ指向アプリケーションデザイン』(Martin Kleppmann著 / O'REILLY)では会計システムの例として「常に貸方と借方は等しくなければならない」という不変性を挙げている。

ただ一息に「一貫性」と言っても具体的に意味するところはどのようなアプリケーションであるかに依存するため、「一貫性」を保つようにトランザクションを適切に定義することはDB側というよりもむしろアプリケーション側の責任となる。

## I: 分離性 (Isolation)

分離性は「並行して実行されたトランザクションが互いに分離されており、最終的なデータ不整合が生じない」こと。

言い換えると「DBは複数のトランザクションが実際には並行に実行されていたとしても、それらがコミットされた後の結果はそれぞれが順番に実行されていた場合と同じになることが保証される」ことを意味する。この後者の意味合いで**直列化可能性 (Serializability)** と呼ばれることもある。

分離性を細かくみていくと、そこにはRead Committed分離、スナップショット分離、直列化可能分離、直列化可能スナップショット分離(SSI) といった複数のレベルがある。この分離レベルについては、また別の記事としてまとめようと思う。

## D: 永続性 (Durability)

永続性は「トランザクションのコミットに成功したなら、その状態が(半)永久的に保持される」ことを求めるものだ。一般的なRDBだと、この特性の実装として「トランザクション開始前とコミット後の状態をログファイル(ジャーナルファイル)に出力する」形になっていることが多い。

例えばMySQLでは「**バイナリログ**」と呼ばれるログファイルに作成・削除・挿入・更新に係る操作イベントを都度記録するよう設定でき、障害時はこのバイナリログを用いてのデータ復旧が可能となっている。

https://www.ritolab.com/posts/98

## 参考

- [『データ指向アプリケーションデザイン』(Martin Kleppmann著 / O'REILLY)](https://www.amazon.co.jp/%E3%83%87%E3%83%BC%E3%82%BF%E6%8C%87%E5%90%91%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3-%E2%80%95%E4%BF%A1%E9%A0%BC%E6%80%A7%E3%80%81%E6%8B%A1%E5%BC%B5%E6%80%A7%E3%80%81%E4%BF%9D%E5%AE%88%E6%80%A7%E3%81%AE%E9%AB%98%E3%81%84%E5%88%86%E6%95%A3%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E8%A8%AD%E8%A8%88%E3%81%AE%E5%8E%9F%E7%90%86-Martin-Kleppmann/dp/4873118700/ref=sr_1_1?adgrpid=76633873172&hvadid=658841596441&hvdev=c&hvlocphy=1009285&hvnetw=g&hvqmt=e&hvrand=14035988162888018837&hvtargid=kwd-771119963913&hydadcr=27270_14678635&jp-ad-ap=0&keywords=%E3%83%87%E3%83%BC%E3%82%BF%E6%8C%87%E5%90%91%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3&qid=1687570105&sr=8-1)
